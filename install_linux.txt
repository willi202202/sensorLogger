Sensors im netz: https://measurements.mobile-alerts.eu/Home/SensorsOverview?phoneid=197061365374

1. System updaten
sudo apt update
sudo apt upgrade -y

2. Basis-Tools
sudo apt install -y git curl

3. Node.js (am besten LTS, z. B. 20)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs
Pruefen:
node -v
==> v20.19.6
npm -v
==> 10.8.2

4. MQTT-Broker (Mosquitto)
sudo apt install -y mosquitto mosquitto-clients
sudo systemctl enable mosquitto
sudo systemctl start mosquitto
Check:
sudo systemctl status mosquitto
mosquitto_sub -h 127.0.0.1 -t "test" -v &
mosquitto_pub -h 127.0.0.1 -t "test" -m "hello"
pgrep -fl mosquitto

5. Python + MQTT-Library
sudo apt install -y python3 python3-pip
sudo apt install python3-paho-mqtt python3-matplotlib

6. MMMMobileAlerts-Repo klonen und Node-Abhaengigkeiten
cd ~
git clone https://github.com/sarnau/MMMMobileAlerts.git
cd MMMMobileAlerts/maserver
npm install

6.1 Fixe IP setzen:
nmcli device
nmcli connection show "Wired connection 1"
sudo nmcli connection modify "Wired connection 1" ipv4.method manual ipv4.addresses 192.168.1.203/24 ipv4.gateway  192.168.1.1 ipv4.dns "1.1.1.1 8.8.8.8"
sudo nmcli connection down "Wired connection 1"
sudo nmcli connection up "Wired connection 1"
sudo reboot

7. config.json vorbereiten
cp config-sample.json config.json
gedit config.json &
hostname -I

Wichtige Felder (Beispiel):
{
  "localIPv4Address": "192.168.1.203"       // IP des Raspis
  "mqtt": "mqtt://127.0.0.1",
  "mqtt_home": "mobilealerts/",
  "mqtt_username": "",
  "mqtt_password": "",
  "publish_type": "default",
  "logfile": "./MobileAlerts.log",
  "logGatewayInfo": true,
  "proxyServerPort": 8089,
  "mobileAlertsCloudForward": true,
  "serverPost": null,
  "serverPostUser": null,
  "serverPostPassword": null,
  "locale": "de-CH"
}

ie localIPv4Address ist die Raspi-IP im LAN, z. B. mit hostname -I auslesen.
proxyServerPort muss zu dem Port passen, den du im Gateway per Proxy setzt (wie vorher 8089).


8. Firewall Port öffnen
sudo ufw allow 8089/tcp comment 'proxyServerPort MobileAlerts'

chmod +x start_mobilealerts.sh
chmod +x stop_mobilealerts.sh

9. Start
./start_mobilealerts.sh

10. Logs anschauen
tail -f ~/MMMMobileAlerts/maserver/mobilealerts.log
tail -f ~/MMMMobileAlerts/maserver/python_mqtt.log

9. Stop
./stop_mobilealerts.sh



10. Fehlerbehebung:

Nur Erreichbarkeit der IP	
ping 192.168.1.203	
Port-Test Ob Proxy läuft:
nc -vz 192.168.1.203 8088
HTTP-Test Proxy antwortet:
curl http://192.168.1.203:8088
MQTT-Sniffer:
mosquitto_sub -t "#" -v
test senden auf MQTT:
mosquitto_pub -h 127.0.0.1 -t "mobilealerts/" -m "hello"
tcpdump kommt was vom Gateway?:
sudo tcpdump -i eth0 tcp port 8089
läuft der prozess:
ps aux | grep mobilealerts.js
prüfen der logs:
tail -f /home/raspiroman/mobilealerts.log

so hats geklappt:
sudo systemctl enable mosquitto &
sudo systemctl start mosquitto
sudo systemctl status mosquitto

cd /home/raspiroman/ProjGitLab/MMMMobileAlerts/maserver
node gatewayConfig.js 
node mobilealerts.js --localIPv4Address=192.168.1.203 --proxyServerPort=8088
nohup node mobilealerts.js --localIPv4Address=192.168.1.203 --proxyServerPort=8088 > mobilealerts.log 2>&1 &
ps aux | grep mobilealerts

cd /home/raspiroman/ProjGitLab/sensorLogger
python mqtt_console_plot.py






